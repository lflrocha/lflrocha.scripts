<?xml version="1.0" encoding="UTF-8"?><filmotech_script_internet><version_editeur>v 3.3.1</version_editeur><informations_script><auteur>Luis Flavio</auteur><sqldate>2018-03-18 00:00:00</sqldate><date>18/03/2018</date><version_script>1.0.5</version_script><version_mini_filmotech>2.3.0</version_mini_filmotech><commentaire>1.0.1 correction requête des titres
1.0.3 maj "analyse du détail"
1.0.4 maj genres, country, languages
1.0.5 Includes IMDB rating in bonus field</commentaire><langue>Anglais</langue><code_langue>en</code_langue></informations_script><informations_site><url>http://www.imdb.com/</url><nom>IMDb</nom></informations_site><scripts><script_0>'  "&amp;&amp;s=tt&amp;&amp;ttype=ft&amp;ref_=fn_ft" : films seulsdim chaine as stringchaine = "http://www.imdb.com/find?q=" + ReplaceAll(fmt_MotsCles," ","+") + "&amp;&amp;s=tt&amp;&amp;ttype=ft&amp;ref_=fn_ft"fmt_EncodagePage ("UTF8")fmt_RequeteListe( "GET", chaine )</script_0><script_1>'  Analyse des titres (films seuls)dim chaine, chaine2, aux as stringdim i, j, k, l as integerdim identifiant, letexte as stringdim debut, fin, nblignes as integerfunction Balise(chaine as string, idebut as integer) as integerdim nblignes, i as integernblignes = fmt_NombreLignes - 1i = idebut -1doi = i +1loop until  instr( fmt_ValeurLigne( i) , chaine ) &lt;&gt; 0 or i = nblignesreturn i 'valeur de la ligne contenant la balise ou nblignes si non trouvéeend function'  balise debut listes filmschaine = "&lt;table class=""findList""&gt;"debut = Balise(chaine, 500)' balise fin listes filmschaine = "&lt;/table&gt;"fin = Balise(chaine, debut)' Recherche de la liste des filmsfor i = debut to finchaine = "&lt;a href=""/title/tt"chaine2 = "&lt;img"letexte = ""j = instr( fmt_ValeurLigne( i ) , chaine )l = instr( fmt_ValeurLigne(i+1), chaine2)if j&lt;&gt;0 AND l=0 thenaux = NthField( fmt_ValeurLigne( i ) , """" , 2 )aux = NthField(aux, "/",3)identifiant = aux' A partir de +1, on saute ce qui commence par "&lt;" et on s'arrête à &lt;/td&gt;k = i+1do 'titre et dateif left( fmt_ValeurLigne( k ) , 1 ) &lt;&gt; "&lt;" AND fmt_ValeurLigne( k ) &lt;&gt; "" thenletexte = letexte + fmt_ValeurLigne( k )end ifk = k + 1loop until fmt_ValeurLigne( k ) = "&lt;/td&gt;" OR k &gt; finfmt_MemoriseTitre ( identifiant , letexte )end ifnext</script_1><script_2>' "/?ref_=fn_al_tt" en ppe suivi du n° du film dans la liste, mais marche avec n'importe quel filmdim chaine as stringchaine = "http://www.imdb.com/title/" +fmt_IdentifiantDetail +"/?ref_=fn_al_tt"fmt_RequeteDetail( "GET", chaine )</script_2><script_3>///// Déclarations////dim chaine, chaine2, letexte, storyline, titre as stringdim baliseD, baliseR  as stringdim i, j, k, fin, debut, indice, index as integerdim NbLignes as Integer  '  var globale (dans les procédures RechercheItem)dim heures, minutes as integerdim condition as booleanfunction Balise(chaine as string, idebut as integer, ifin as integer) as integerdim i as integeri = idebut -1doi = i +1loop until  instr( fmt_ValeurLigne( i) , chaine ) &lt;&gt; 0 or i = ifinreturn i 'valeur de la ligne contenant la balise ou ifin si non trouvéeend functionfunction BaliseExacte(chaine as string, idebut as integer, ifin as integer) as integerdim i as integeri = idebut -1doi = i +1loop until  trim(fmt_ValeurLigne( i)) = chaine   or i = ifinreturn i 'valeur de la ligne contenant la balise ou ifin si non trouvéeend functionSub RechercheItem(Bdebut as string, Bfin as String, Brecherche as string, separateur as string, memorise as string, byref indice as integer)dim tableau() as stringdim debut, fin as integerdebut = balise(Bdebut,indice, nblignes)fin = balise(Bfin,debut, nblignes)if debut &lt;&gt; nblignes and fin &lt;&gt; nblignes thenindice = debut +1	doindice = balise(Brecherche, indice, fin)if indice &lt;&gt; fin thentableau.append  fmt_ValeurLigne(indice+1)indice = indice +2end ifloop until indice = finfmt_MemoriseValeur( memorise , join(tableau, separateur) )indice = fin + 1end ifend subSub RechercheItem2(Bfin as String, Brecherche as string, separateur as string, memorise as string, byref indice as integer)dim tableau() as stringdim fin as integer'  indice doit etre l'indice de Brecherchefin = balise(Bfin,indice,nblignes)if  fin &lt;&gt; nblignes thendoindice = balise(Brecherche, indice, fin)if indice &lt;&gt; fin thentableau.append  fmt_ValeurLigne(indice+1)indice = indice +2end ifloop until indice = finfmt_MemoriseValeur( memorise , join(tableau, separateur) )indice = fin + 1end ifend subSub rechercheItem3(BaliseD as string, champ as string)dim debut, fin, i as integerdim condition as booleandim tableau(), letexte as stringdebut = baliseExacte(baliseD, 1000, nblignes)condition = falseif debut &lt;&gt; nblignes thenfin = baliseExacte("&lt;/div&gt;", debut, debut + 50)if fin &lt;&gt; debut +50 thencondition = trueend ifend ifif condition then' redim tableau(-1)letexte=""for i = debut+2 to finif left( fmt_ValeurLigne( i ) , 1 ) &lt;&gt; "&lt;" AND trim(fmt_ValeurLigne( i )) &lt;&gt; "" and trim(fmt_ValeurLigne( i )) &lt;&gt; "|" thentableau.append trim(fmt_ValeurLigne( i ))end ifnextletexte= join( tableau, ", ")fmt_MemoriseValeur( champ , letexte )end ifend sub//// Corps du programme ////' initialisationsindice = 500  'on ne craint pas grand chose...NbLignes =  fmt_NombreLignes - 100' Recherche de l'affichechaine = """ itemprop=""image"" /&gt;"letexte = ""debut=balise(chaine,indice, nblignes)if debut &lt;&gt;  nblignes then   ' on a bien trouvé chaine (sinon il n'exite pas d'affiche)chaine2= fmt_ValeurLigne(debut)letexte = NthField(chaine2, """" , 6 )indice = debut +1  'sinon indice reste à sa valeur initialefmt_RequeteImage( "GET" , letexte )end if' Recherche titre et année' nb : le titre ("VF") est tel qu'affiché dans la page de IMDB (donc il peut-etre en anglais ou...)chaine= "&lt;h1 class=""header""&gt;"debut=balise(chaine,indice, nblignes)chaine = "&lt;/h1&gt;"fin = balise(chaine,debut, nblignes)if debut &lt;&gt;  nblignes then   titre =  fmt_ValeurLigne(debut+3)fmt_MemoriseValeur( "TitreVF" , titre )letexte =  fmt_ValeurLigne(debut+9)fmt_MemoriseValeur( "annee" , letexte )indice = debut + 2elsechaine = "&lt;div class=""title_wrapper""&gt;"debut=balise(chaine,800, nblignes)if debut &lt;&gt; nblignes thentitre =  fmt_ValeurLigne(debut+3)fmt_MemoriseValeur( "TitreVF" , titre )letexte =  fmt_ValeurLigne(debut+7)fmt_MemoriseValeur( "annee" , letexte )indice = debut + 2end ifend if' Titre VO (original title) (s'il existe)'  chaine ="&lt;span class=""title-extra"""' debut= balise(chaine,indice, fin)chaine = "&lt;div class=""originalTitle""&gt;"debut= balise(chaine,indice, nblignes)if debut &lt;&gt; fin thenletexte =  fmt_ValeurLigne(debut+1)letexte = trim(letexte)fmt_MemoriseValeur( "TitreVO" , letexte)indice = indice +2elsefmt_MemoriseValeur( "TitreVO" , titre)end if' Ratingschaine = "&lt;span itemprop=""ratingValue""&gt;"index = BaliseExacte(chaine, 0, fin)letexte = fmt_ValeurLigne(index+1)fmt_MemoriseValeur( "Rating", letexte)fmt_MemoriseValeur( "Bonus", letexte)' Recherche duréechaine ="&lt;time itemprop=""duration""" debut=balise(chaine,850, nblignes)'  fmt_DebugMsg str(debut) + "   " + str(indice)if debut &lt;&gt; nblignes thenletexte = fmt_ValeurLigne(debut+1)  ' exprimé en h et mn ou en mn seules (ou peut-être rien...)if instr(fmt_ValeurLigne(debut+1),"h" ) &lt;&gt; 0 then   '  il existe un caractère hheures =  val(trim( NthField( letexte , "h" , 1 )))minutes = val(trim( NthField(NthField( letexte , "h" , 2 ), "min",1)))letexte = str( heures * 60 + minutes )end iffmt_MemoriseValeur( "Duree" , letexte )indice = debut +1end if'' Genre, après story line, à partir de "Genres:"baliseD = "Genres:"RechercheItem3(baliseD, "Genre")'PaysbaliseD = "Country:"RechercheItem3(baliseD, "Pays")' LanguesbaliseD = "Language:" RechercheItem3(baliseD, "langues")'  Réalisateur(s) baliseR = "&lt;span class=""itemprop"" itemprop=""name""&gt;"debut = balise(baliseR, indice, nblignes)if debut &lt;&gt; nblignes thenindice = debutRechercheItem2("&lt;/div&gt;", baliseR, chr(13), "realisateurs", indice)end if' Acteurs (tous)baliseD = "&lt;table class=""cast_list""&gt;"   baliseR = "&lt;span class=""itemprop"" itemprop=""name""&gt;"RechercheItem(baliseD,  "&lt;/table&gt;" , baliseR, chr(13), "acteurs", indice)'' StorylinebaliseD = "Storyline"  ' recherche exacte, après acteurs, mais acteurs n'existe pas nécessairement !' si acteurs n'existe pas on ne tombe pas sur le bon storyline, et en général il n'existe pas, donc on ne fait rien...debut = baliseexacte(baliseD,indice,nblignes)condition = falseif debut &lt;&gt; nblignes thenif fmt_ValeurLigne(debut - 1) = "&lt;h2&gt;" then  'c'est en ppe le bon storyline...condition = trueend ifend ifif condition thenk = BaliseExacte("&lt;p&gt;", debut, nblignes)if k &lt;&gt; nblignes and k &lt; debut + 15 then  '  storyline existe (en ppe)fin= BaliseExacte("&lt;/p&gt;", k, nblignes)storyline = ""i = k+1j=1dochaine = fmt_ValeurLigne(i)condition = left(chaine,1) &lt;&gt; "&lt;"  and trim(chaine)&lt;&gt; "" and left(trim(chaine),1) &lt;&gt; "&amp;"if  condition  thenif chaine = "Written by " thenstoryline = trim(storyline) + chr(13)elseif j=1 thenchaine = Ltrim(chaine)end ifend ifstoryline = storyline + chaineend ifi = i +1j=j+1loop until i=finfmt_MemoriseValeur( "synopsis" , storyline )end ifend if</script_3></scripts></filmotech_script_internet>